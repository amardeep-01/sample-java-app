name: ACHIEVE-Service-CICD

on:
  push:
    branches:
      - '**' 
    tags:   
      - 'dev_v*'  
      - 'uat_v*'    
      - 'qa_v*'  
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        description: Select Environment
        options:
          - DEV
          - QA
          - UAT
 
jobs:
  deploy:
    if: startsWith(github.ref, 'refs/tags/DEV-') || startsWith(github.ref, 'refs/tags/QA-')
    runs-on: ${{ startsWith(github.ref, 'refs/tags/dev-') && 'self-hosted' || startsWith(github.ref, 'refs/tags/QA-') && 'self-hosted' }}
 
    steps:
      - name: Determine Runner
        id: determine-runner
        run: |
          if [[ "${GITHUB_REF}" == refs/tags/dev-* ]]; then
            echo "::set-output name=runner::DEV"
          elif [[ "${GITHUB_REF}" == refs/tags/QA-* ]]; then
            echo "::set-output name=runner::QA"
          fi
 
      - name: Checkout code
        uses: actions/checkout@v2
 
      - name: Deploy to Environment
        run: |
          echo "Deploying to ${{ steps.determine-runner.outputs.runner }} Environment"
          # Your deployment script or commands for the environment
